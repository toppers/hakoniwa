<!doctype html><html lang=ja><head><meta name=generator content="Hugo 0.118.2"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>箱庭のアーキテクチャ</title><meta name=description content="[Getting Started 0] 箱庭のシステムアーキテクチャと動作の仕組みを紹介します"><meta name=author content="TOPPERS Project Hakoniwa WG"><meta property="og:title" content="箱庭のアーキテクチャ"><meta property="og:description" content="[Getting Started 0] 箱庭のシステムアーキテクチャと動作の仕組みを紹介します"><meta property="og:type" content="article"><meta property="og:url" content="https://toppers.github.io/hakoniwa/getting-started/architecture-overview/"><meta property="og:image" content="https://toppers.github.io/hakoniwa/img/hakoniwa/icon-310x310.png"><meta property="article:section" content="getting-started"><meta property="article:published_time" content="2022-05-14T13:26:27+09:00"><meta property="article:modified_time" content="2022-05-14T13:26:27+09:00"><meta name=twitter:card content="summary"><meta name=twitter:site content="@toppersjp"><meta property="fb:app_id" content="3035581286538848"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-169187702-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=canonical href=https://toppers.github.io/hakoniwa/getting-started/architecture-overview/><link rel=icon type=image/png href=/hakoniwa/img/hakoniwa/favicon-32x32.png><link href=/hakoniwa/css/font.css rel=stylesheet type=text/css><link href=/hakoniwa/css/kube.min.css rel=stylesheet type=text/css><link href=/hakoniwa/css/kube.legenda.css rel=stylesheet type=text/css><link href=/hakoniwa/css/highlight.css rel=stylesheet type=text/css><link href=/hakoniwa/css/main.css rel=stylesheet type=text/css><link href=/hakoniwa/css/custom.css rel=stylesheet type=text/css><script src=/hakoniwa/js/jquery-2.1.4.min.js type=text/javascript></script><script type=text/javascript src=/hakoniwa/js/tocbot.min.js></script></head><body class=page-kube><header><div class=show-sm><div id=nav-toggle-box><div id=nav-toggle-brand><a href=/hakoniwa>箱庭</a></div><a data-component=toggleme data-target=#top href=# id=nav-toggle><i class=kube-menu></i></a></div></div><div class=hide-sm id=top><div id=top-brand><a href=/hakoniwa title=home><img src=/hakoniwa/img/hakoniwa/icon-70x70.png></a></div><nav id=top-nav-main><ul><li><a href=/hakoniwa/docs/>箱庭とは</a></li><li><a href=/hakoniwa/prototypes/>プロトタイプモデル</a></li><li><a href=/hakoniwa/technical-links/>技術情報</a></li><li><a href=/hakoniwa/showcase/>ショーケース</a></li><li><a href=/hakoniwa/tutorial/>チュートリアル</a></li><li><a href=/hakoniwa/repositories/>リポジトリ</a></li><li><a href=/hakoniwa/contact/>SNS・問合せ先</a></li></ul></nav><nav id=top-nav-extra><ul><li><a href=# class="active language">JP</a></li></ul></nav></div></header><main><div id=main><div id=hero><h1>箱庭のアーキテクチャ</h1><p class=hero-lead>[Getting Started 0] 箱庭のシステムアーキテクチャと動作の仕組みを紹介します.</p></div><div id=kube-component class=content><h3 id=前提環境>前提環境</h3><p><a href=https://github.com/toppers/hakoniwa-ros2sim>箱庭 ROS シミュレータ:hakoniwa-ros2sim</a>
を例題に解説するため、このチュートリアルが終わっておりプロジェクトが参照できることが望ましいです。</p><h3 id=ros向け箱庭のシステム構成>ROS向け箱庭のシステム構成</h3><p>ros2simのプロジェクトでは、Unity上のTortleBot3(tb3)をROS2のアプリから制御するシミュレーションを行います。
以下にWindows/WSL2でのシステム構成を示しています。大まかには制御対象であるUnity上のtb3とそれを制御するtb3ctrlがROSで通信しています。</p><p><img src=/hakoniwa/img/getting-started/ros2sim_overview.png alt=ROS向け箱庭のシステム構成></p><h3 id=フォルダ構成>フォルダ構成</h3><p>githubからCloneしたプロジェクトのフォルダ構成は以下のようになっています。主に/ros2/workspace, /ros2/unityを扱えばよく、
他のフォルダは本説明には含まれないため一旦無視してください。</p><ul><li>hakowani-ros2sim/<ul><li>ros2/<ul><li>workspace/ : ROSのワークスペース。Docker上にマウントされる</li><li>unity/tb3/ : Unityのプロジェクト</li></ul></li></ul></li></ul><p>workspace/はROSのワークスペースで、ここに制御用のROSアプリを作成します。src下にはいくつかアプリが入っていますが、
tb3ロボットを制御しているのはtb3フォルダ下のソースとなります。
プログラムを修正した場合は<code>bash build.bash</code>を行うことでビルドされアプリが更新されます。</p><p>unity/はUnityプロジェクトが入っており、Unity Editorからtb3フォルダを開くと読み込めます。
cloneしたすぐの状態では、すべてのアセットは揃っておらずhako-install.bashによって必要なアセットのダウンロードや設定を行います。</p><h3 id=チュートリアルでの操作による挙動>チュートリアルでの操作による挙動</h3><ul><li><code>$ bash docker/pull-image.bash</code> : 本プロジェクトで用いるROSが入ったDockerイメージの取得を行っています。</li><li><code>$ bash docker/run.bash</code> : 取得したDockerのコンテナを作成しbashでログインします。またこの時カレントディレクトリにworkspace以下をマウントしています。</li><li><code># bash hako-install.bash</code> : unityフォルダにUnityのプロジェクトを展開すると共に、ROSと繋ぐための初期設定を行います。</li><li><code>(Terminal A)$ bash run.bash</code> : Dockerコンテナを起動しbashでログインします。</li><li><code>(Terminal A)# bash launch.bash</code> : UnityとROSで通信するための、ROS-TCP-Endpointを起動します。またUnityプロジェクトにはこのプログラムと対になる</li><li><code>(Terminal B)$ bash attach.bash</code> : Terminal Aで立ち上げたコンテナに入ります。</li><li><code>(Terminal B)# bash run.bash</code> : ロボットを制御するROSアプリのtb3ctrlを実行します。このプログラムのソースはworkspace/src/tb3/src/tb3ctrl.cppです。</li></ul><h3 id=heading></h3><div class=xPrevNextLink><div class=xPrevNextLink_next><a href=https://toppers.github.io/hakoniwa/getting-started/app-customize/>制御プログラムの変更方法</a></div></div><script>document.addEventListener("DOMContentLoaded",function(){var e,t={"#slide-up-btn":{el:"#animation-box-slide-up",to:"slideUp",back:"slideDown"},"#slide-down-btn":{el:"#animation-box-slide-down",to:"slideDown",back:"slideUp"},"#fade-in-btn":{el:"#animation-box-fade-in",to:"fadeIn",back:"fadeOut"},"#fade-out-btn":{el:"#animation-box-fade-out",to:"fadeOut",back:"fadeIn"},"#flip-in-btn":{el:"#animation-box-flip-in",to:"flipIn",back:"flipOut"},"#flip-out-btn":{el:"#animation-box-flip-out",to:"flipOut",back:"flipIn"},"#zoom-in-btn":{el:"#animation-box-zoom-in",to:"zoomIn",back:"zoomOut"},"#zoom-out-btn":{el:"#animation-box-zoom-out",to:"zoomOut",back:"zoomIn"},"#slide-in-right-btn":{el:"#animation-box-slide-in-right",to:"slideInRight",back:"slideOutRight"},"#slide-in-left-btn":{el:"#animation-box-slide-in-left",to:"slideInLeft",back:"slideOutLeft"},"#slide-in-down-btn":{el:"#animation-box-slide-in-down",to:"slideInDown",back:"slideOutUp"},"#slide-out-right-btn":{el:"#animation-box-slide-out-right",to:"slideOutRight",back:"slideInRight"},"#slide-out-left-btn":{el:"#animation-box-slide-out-left",to:"slideOutLeft",back:"slideInLeft"},"#slide-out-up-btn":{el:"#animation-box-slide-out-up",to:"slideOutUp",back:"slideInDown"}};for(e in t)$(e).attr("data-el",t[e].el),$(e).attr("data-to",t[e].to),$(e).attr("data-back",t[e].back),$(e).on("click",function(e){e.preventDefault();var n,t=$(e.target);if(t.hasClass("demo-muted-link"))return;n=$(t.attr("data-el")),t.addClass("demo-muted-link"),n.animation(t.attr("data-to")),setTimeout(function(){n.animation(t.attr("data-back")),t.removeClass("demo-muted-link")},1500)});$("#rotate-btn").on("click",function(e){e.preventDefault(),$("#animation-box-rotate").animation("rotate")}),$("#shake-btn").on("click",function(e){e.preventDefault(),$("#animation-box-shake").animation("shake")}),$("#pulse-btn").on("click",function(e){e.preventDefault(),$("#animation-box-pulse").animation("pulse")})})</script></div></div></main><footer><footer id=footer><nav><ul><li><span>HAKONIWA-WG</span></li></ul></nav><p>&copy; 2019- by Hakoniwa Working-Group, TOPPERS Project</p></footer></footer><script src=/hakoniwa/js/kube.js type=text/javascript></script><script src=/hakoniwa/js/kube.legenda.js type=text/javascript></script><script src=/hakoniwa/js/main.js type=text/javascript></script></body></html>