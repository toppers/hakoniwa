<!doctype html><html lang=ja><head><meta name=generator content="Hugo 0.111.3"><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>単体ロボット向けシミュレータ導入手順</title><meta name=author content="TOPPERS Project Hakoniwa WG"><meta property="og:title" content="単体ロボット向けシミュレータ導入手順"><meta property="og:description" content="Unityのインストール・パッケージのインポート・通信方式の切替方法 Unityのインストール Unityのインストール方法は色々なサイト・書籍で紹介されておりますので，インストールください．
以下のサイト等が参考になるかと思います．
https://tech-camp.in/note/technology/44408/ ※動作確認はUnity 2020.1.0b9(64bit)で行っております．
使用する場合はこれ以降のバージョンのUnityをインストールすることをお勧めします．
Unityパッケージのインポート Unity 起動 まず，インストールしたUnityを起動してください．
無事起動すると以下のような画面が出ますので，右上の「新規作成」を選択し新規プロジェクト作成します．
次の選択画面で，「プロジェクト名」に適当なプロジェクト名を設定して，「作成」ボタンを押下してください．
成功すると，以下のようにUnityが起動します．
Unityパッケージのインポート ※画像はsingle-robot-HackEV.unitypackageをインポートする際のものになります
Unity のメニューから，「Assets」⇒「Import Package」⇒「Custom Package&mldr;」と選択し，任意の unitypackageファイルを選択してください．
成功すると，下図の画面がポップアップされますので，素直に「Import」ボタンを押下してください．
成功するとProject/Scenes配下にToppers_Courseというシーンが追加されます． Toppers_Courseをダブルクリックすると下図の画面が現れます．
次に，シミュレーションに関わる設定を変更します．
Unity のメニューから，「Edit」⇒「Project Settings」を選択します．
「Time」
Fixed Timestep を 0.001に， Time Scale を 0.6に設定します．
※ev3rt-simple-robot.unitypackageを使用する場合で，もしシミュレーションの動作が
遅い場合には，Fixed Timestep を 0.01に，EV3 Motor(Script)のIntervalを 0.0005に
設定してください．
「Quality」
OtherのVSync Count を Don&rsquo;t Sync に設定します．
これでインポート作業終了です．
通信方式の切替方法 athrillとUnity間での通信方式に設定を行います．
設定はconfig.jsonという設定ファイルを作成し，設定を行います．
config.json の設定例(通信方式がMMAPの場合) 設定するファイルパスは全て絶対パスで記述します．
{ &#34;AthrillPath&#34;:&#34;/mnt/c/project/esm/athrill/bin/linux/athrill2&#34;, &#34;TerminalPath&#34;:&#34;C:\\Windows\\System32\\wsl.exe&#34;, &#34;robots&#34;:[ { &#34;RobotName&#34;:&#34;RoboModel&#34;, &#34;WorkspacePathWin&#34;:&#34;C:\\project\\esm\\ev3rt-athrill-v850e2m\\sdk\\workspace&#34;, &#34;WorkspacePathUnix&#34;:&#34;/mnt/c/project/esm/ev3rt-athrill-v850e2m/sdk/workspace&#34;, &#34;ApplicationName&#34;:&#34;touch_sensor&#34;, &#34;BinaryName&#34;:&#34;asp&#34; } ] } config."><meta property="og:type" content="article"><meta property="og:url" content="https://toppers.github.io/hakoniwa/single-robot-setup-detail/60_unity_install_v2.1/"><meta property="og:image" content="https://toppers.github.io/hakoniwa/img/hakoniwa/icon-310x310.png"><meta property="article:section" content="single-robot-setup-detail"><meta name=twitter:card content="summary"><meta name=twitter:site content="@toppersjp"><meta property="fb:app_id" content="3035581286538848"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-169187702-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<link rel=canonical href=https://toppers.github.io/hakoniwa/single-robot-setup-detail/60_unity_install_v2.1/><link rel=icon type=image/png href=/hakoniwa/img/hakoniwa/favicon-32x32.png><link href=/hakoniwa/css/font.css rel=stylesheet type=text/css><link href=/hakoniwa/css/kube.min.css rel=stylesheet type=text/css><link href=/hakoniwa/css/kube.legenda.css rel=stylesheet type=text/css><link href=/hakoniwa/css/highlight.css rel=stylesheet type=text/css><link href=/hakoniwa/css/main.css rel=stylesheet type=text/css><link href=/hakoniwa/css/custom.css rel=stylesheet type=text/css><script src=/hakoniwa/js/jquery-2.1.4.min.js type=text/javascript></script><script type=text/javascript src=/hakoniwa/js/tocbot.min.js></script></head><body class=page-kube><header><div class=show-sm><div id=nav-toggle-box><div id=nav-toggle-brand><a href=/hakoniwa>箱庭</a></div><a data-component=toggleme data-target=#top href=# id=nav-toggle><i class=kube-menu></i></a></div></div><div class=hide-sm id=top><div id=top-brand><a href=/hakoniwa title=home><img src=/hakoniwa/img/hakoniwa/icon-70x70.png></a></div><nav id=top-nav-main><ul><li><a href=/hakoniwa/docs/>箱庭とは</a></li><li><a href=/hakoniwa/prototypes/>プロトタイプモデル</a></li><li><a href=/hakoniwa/technical-links/>技術情報</a></li><li><a href=/hakoniwa/showcase/>ショーケース</a></li><li><a href=/hakoniwa/getting-started/>Getting Started</a></li><li><a href=/hakoniwa/repositories/>リポジトリ</a></li><li><a href=/hakoniwa/contact/>SNS・問合せ先</a></li></ul></nav><nav id=top-nav-extra><ul><li><a href=# class="active language">JP</a></li></ul></nav></div></header><main><div id=main><div id=hero><h1>単体ロボット向けシミュレータ導入手順</h1><p class=hero-lead>.</p></div><div id=kube-component class=content><h1 id=unityのインストールパッケージのインポート通信方式の切替方法>Unityのインストール・パッケージのインポート・通信方式の切替方法</h1><h2 id=unityのインストール>Unityのインストール</h2><hr><p>Unityのインストール方法は色々なサイト・書籍で紹介されておりますので，インストールください．</p><p>以下のサイト等が参考になるかと思います．</p><ul><li><a href=https://tech-camp.in/note/technology/44408/>https://tech-camp.in/note/technology/44408/</a></li></ul><p>※動作確認は<code>Unity 2020.1.0b9(64bit)</code>で行っております．<br>　使用する場合はこれ以降のバージョンのUnityをインストールすることをお勧めします．</p><h2 id=unityパッケージのインポート>Unityパッケージのインポート</h2><hr><h3 id=unity-起動>Unity 起動</h3><p>まず，インストールしたUnityを起動してください．<br>無事起動すると以下のような画面が出ますので，右上の「新規作成」を選択し新規プロジェクト作成します．</p><figure><img src=/hakoniwa/img/single-robot/unity_invoke.png border width=800></figure><p>次の選択画面で，「プロジェクト名」に適当なプロジェクト名を設定して，「作成」ボタンを押下してください．</p><figure><img src=/hakoniwa/img/single-robot/unity_create_project.png border width=800></figure><p>成功すると，以下のようにUnityが起動します．</p><figure><img src=/hakoniwa/img/single-robot/unity_start.png border width=800></figure><h3 id=unityパッケージのインポート-1>Unityパッケージのインポート</h3><p>※画像は<code>single-robot-HackEV.unitypackage</code>をインポートする際のものになります</p><p>Unity のメニューから，「Assets」⇒「Import Package」⇒「Custom Package&mldr;」と選択し，任意の unitypackageファイルを選択してください．</p><p>成功すると，下図の画面がポップアップされますので，素直に「Import」ボタンを押下してください．</p><figure><img src=/hakoniwa/img/single-robot/unity_import.png border width=300></figure><p>成功するとProject/Scenes配下にToppers_Courseというシーンが追加されます．
Toppers_Courseをダブルクリックすると下図の画面が現れます．</p><figure><img src=/hakoniwa/img/single-robot/unity_HackEV.png border width=900></figure><p>次に，シミュレーションに関わる設定を変更します．</p><p>Unity のメニューから，「Edit」⇒「Project Settings」を選択します．</p><p>「Time」<br><code>Fixed Timestep</code> を 0.001に，
<code>Time Scale</code> を 0.6に設定します．</p><figure><img src=/hakoniwa/img/single-robot/unity_setting_time.png border width=700></figure><p>※<code>ev3rt-simple-robot.unitypackage</code>を使用する場合で，もしシミュレーションの動作が<br>遅い場合には，<code>Fixed Timestep</code> を 0.01に，EV3 Motor(Script)の<code>Interval</code>を 0.0005に<br>設定してください．</p><p>「Quality」<br><code>Other</code>の<code>VSync Count</code> を Don&rsquo;t Sync に設定します．</p><figure><img src=/hakoniwa/img/single-robot/unity_setting_quality.png border width=700></figure><p>これでインポート作業終了です．</p><h2 id=通信方式の切替方法>通信方式の切替方法</h2><hr><p>athrillとUnity間での通信方式に設定を行います．<br>設定は<code>config.json</code>という設定ファイルを作成し，設定を行います．</p><h4 id=configjson-の設定例通信方式がmmapの場合>config.json の設定例(通信方式がMMAPの場合)</h4><p>設定するファイルパスは全て絶対パスで記述します．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;AthrillPath&#34;</span>:<span style=color:#e6db74>&#34;/mnt/c/project/esm/athrill/bin/linux/athrill2&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;TerminalPath&#34;</span>:<span style=color:#e6db74>&#34;C:\\Windows\\System32\\wsl.exe&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;robots&#34;</span>:[
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;RobotName&#34;</span>:<span style=color:#e6db74>&#34;RoboModel&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;WorkspacePathWin&#34;</span>:<span style=color:#e6db74>&#34;C:\\project\\esm\\ev3rt-athrill-v850e2m\\sdk\\workspace&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;WorkspacePathUnix&#34;</span>:<span style=color:#e6db74>&#34;/mnt/c/project/esm/ev3rt-athrill-v850e2m/sdk/workspace&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;ApplicationName&#34;</span>:<span style=color:#e6db74>&#34;touch_sensor&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;BinaryName&#34;</span>:<span style=color:#e6db74>&#34;asp&#34;</span>
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=configjson-の設定例通信方式がudpの場合>config.json の設定例(通信方式がUDPの場合)</h4><p>設定するファイルパスは全て絶対パスで記述します．</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;AthrillPath&#34;</span>:<span style=color:#e6db74>&#34;/mnt/c/project/hakoniwa/athrill/bin/linux/athrill2&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;TerminalPath&#34;</span>:<span style=color:#e6db74>&#34;C:\\Windows\\System32\\wsl.exe&#34;</span>,
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;robots&#34;</span>:[
</span></span><span style=display:flex><span>		{
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;RobotName&#34;</span>:<span style=color:#e6db74>&#34;RoboModel&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;WorkspacePathWin&#34;</span>:<span style=color:#e6db74>&#34;C:\\project\\hakoniwa\\ev3rt-athrill-v850e2m\\sdk\\workspace&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;WorkspacePathUnix&#34;</span>:<span style=color:#e6db74>&#34;/mnt/c/project/hakoniwa/ev3rt-athrill-v850e2m/sdk/workspace&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;ApplicationName&#34;</span>:<span style=color:#e6db74>&#34;touch_sensor&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;BinaryName&#34;</span>:<span style=color:#e6db74>&#34;asp&#34;</span>,
</span></span><span style=display:flex><span>			<span style=color:#f92672>&#34;Udp&#34;</span>:
</span></span><span style=display:flex><span>			{
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;AthrillIpAddr&#34;</span>:<span style=color:#e6db74>&#34;127.0.0.1&#34;</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;AthrillPort&#34;</span>:<span style=color:#ae81ff>54002</span>,
</span></span><span style=display:flex><span>				<span style=color:#f92672>&#34;UnityPort&#34;</span>:<span style=color:#ae81ff>54001</span>
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	]
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=各設定パラメータについて>各設定パラメータについて</h4><ul><li><strong>AthrillPath</strong><br>athrill2のパスを設定します．Windows版の場合は，WSL上でのパスを指定します．</li><li><strong>TerminalPath</strong><br>ターミナルプログラムのパスを設定します．
Windows版の場合は，wsl.exeのパスを設定します．<br>mac版の場合は，<code>/usr/bin/open</code>と記述します．</li><li><strong>robots</strong><br>Unity上のRobot配下のロボット群を指します．複数のロボットにも対応しており，ここの中で各ロボット毎の設定を行うことが出来ます．<br>ロボットが1台の場合は，robots内の設定は1つとなります．</li><li><strong>RobotName</strong><br>Unity上のRobot配下のロボットの名前を設定します．</li><li><strong>WorkspacePathWin</strong><br>動作させるアプリケーションの実行環境のファイルパスを記述します．Windows版の場合はWindows上でのパスを設定します．<br>それ以外のプラットフォームの場合は，下記の<code>WorkspacePathUnix</code>と同じ値を設定してください．</li><li><strong>WorkspacePathUnix</strong><br>動作させるアプリケーションの実行環境のファイルパスを記述します．Windows版の場合はwsl上でのパスを設定します．</li><li><strong>ApplicationName</strong><br>動作させるアプリケーションのフォルダ名を設定します．</li><li><strong>BinaryName</strong><br>athrillが実行するバイナリファイルの名前を設定します．特に名前変更などをしていない限り，ファイル名は<code>asp</code>となります．</li><li><strong>Udp</strong><br>UDPとMMAPどちらの通信方式を使用するか設定します．MMAPを使用する場合は，この項目を省略してください．</li><li><strong>AthrillIpAddr</strong><br>athrillを実行する端末のIPアドレスです．athrillを実行する端末とUnityを実行する端末が同じ場合は，<code>127.0.0.1</code>と設定していれば問題ありません．</li><li><strong>AthrillPort</strong><br>athrillを実行する端末が空けている任意のポート番号を設定します．</li><li><strong>UnityPort</strong><br>Unityを実行する端末が空けている任意のポート番号を設定します．</li></ul><h4 id=configjson-を配置する>config.json を配置する</h4><p>作成したconfig.jsonを使用しているUnityプロジェクトのフォルダ配下に配置します．</p><p><strong>例：Unityプロジェクトの名前が<code>single-robo</code>の場合</strong><br>　→　<code>C:\UnityProjects\single-robo</code>直下</p><p>※<code>UnityProjects</code>はプロジェクト作成用に用意した任意のフォルダです．<br>　ユーザがプロジェクトを作成したフォルダに置き換えてください．</p><h3 id=mmapについて>MMAPについて</h3><p>MMAPにすると嬉しい点としては以下が挙げられます．</p><ul><li>UDP のように通信ロストは発生しない(シミュレーション精度向上につながる)</li><li>Unity と athrill 間のやりとりは共有メモリベースなので，高速になる(と思われる)</li><li>上記のとおり，精度向上と高速性を期待して試行してみましたが，精度は良くなりました(速度はあまり変化ないような?)．</li></ul><p>ただし，デメリットとして以下が挙げられます．</p><ul><li>1マシン前提での構成を余儀なくされる<ul><li>UDPであれば，athrillを別PCに配置して負荷分散可能ですので．</li></ul></li></ul></div></div></main><footer><footer id=footer><nav><ul><li><span>HAKONIWA-WG</span></li></ul></nav><p>&copy; 2019- by Hakoniwa Working-Group, TOPPERS Project</p></footer></footer><script src=/hakoniwa/js/kube.js type=text/javascript></script><script src=/hakoniwa/js/kube.legenda.js type=text/javascript></script><script src=/hakoniwa/js/main.js type=text/javascript></script></body></html>