<!doctype html><html lang=ja><head><meta name=generator content="Hugo 0.120.4"><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>単体ロボット向けシミュレータ使用手順(ARM版) </title><meta name=author content="TOPPERS Project Hakoniwa WG"><meta property="og:title" content="単体ロボット向けシミュレータ使用手順(ARM版)"><meta property="og:description" content="単体ロボット向けシミュレータ使用手順(ARM版) 使用手順 環境変数の設定(Mac版のみ) cfgフォルダの配置(初回起動時のみ) EV3ロボット制御プログラムのビルド Unityのシミュレータの起動 athrillの起動 環境変数の設定(Mac版のみ) Mac版の場合，gccインストールフォルダの環境変数の設定が必要になります．
export GCC_PATH=<gccインストールフォルダ>/gcc-arm-none-eabi-9-2019-q4-major cfgフォルダの配置(初回起動時のみ) cfg ファイルの配置(Mac版の場合)
$ pwd <インストールフォルダ>/ev3rt-athrill-ARMv7-A $ mkdir cfg/cfg $ cp cfg/cfg-mac cfg/cfg/cfg $ chmod +x cfg/cfg/cfg cfg ファイルの配置(Windows\Linux版の場合)
$ pwd <インストールフォルダ>/ev3rt-athrill-ARMv7-A $ mkdir cfg/cfg $ cp cfg/cfg-linux-64 cfg/cfg/cfg $ chmod +x cfg/cfg/cfg EV3ロボット制御プログラムのビルド ターミナル上で，ev3rt-athrill-ARMv7-A/sdk/OBJ1.1に移動して，
EV3ロボット制御プログラムをビルドしましょう．
ビルドするには，以下のコマンドを実行してください．
make clean;make ビルド成功すると，asp というバイナリができます．
$ ls asp asp Unityのシミュレータの起動 ※必ず，athrillの起動より先にUnityのシミュレータの起動を行ってください
次に，Unityをシミュレーションモードにします． Unityの画面上で　ボタンを押下してください．
成功すると，下図のような画面に切り替わります．(画像は single-robot-HackEV.unitypackage の場合)
athrillの起動 最後に，athrillを起動しましょう．
ev3rt-athrill-ARMv7-A/sdk/OBJ1.1に移動して，以下のコマンドを実行してください．
unityとの通信が UDP の場合 UDP版の場合"><meta property="og:type" content="article"><meta property="og:url" content="https://toppers.github.io/hakoniwa/single-robot-usage/01_usage_arm_v2.0/"><meta property="og:image" content="https://toppers.github.io/hakoniwa/img/hakoniwa/icon-310x310.png"><meta property="article:section" content="single-robot-usage"><meta name=twitter:card content="summary"><meta name=twitter:site content="@toppersjp"><meta property="fb:app_id" content="3035581286538848"><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-169187702-1","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script><link rel=canonical href=https://toppers.github.io/hakoniwa/single-robot-usage/01_usage_arm_v2.0/><link rel=icon type=image/png href=/hakoniwa/img/hakoniwa/favicon-32x32.png><link href=/hakoniwa/css/font.css rel=stylesheet type=text/css><link href=/hakoniwa/css/kube.min.css rel=stylesheet type=text/css><link href=/hakoniwa/css/kube.legenda.css rel=stylesheet type=text/css><link href=/hakoniwa/css/highlight.css rel=stylesheet type=text/css><link href=/hakoniwa/css/main.css rel=stylesheet type=text/css><link href=/hakoniwa/css/custom.css rel=stylesheet type=text/css><script src=/hakoniwa/js/jquery-2.1.4.min.js type=text/javascript></script><script type=text/javascript src=/hakoniwa/js/tocbot.min.js></script></head><body class=page-kube><header><div class=show-sm><div id=nav-toggle-box><div id=nav-toggle-brand><a href=/hakoniwa>箱庭</a></div><a data-component=toggleme data-target=#top href=# id=nav-toggle><i class=kube-menu></i></a></div></div><div class=hide-sm id=top><div id=top-brand><a href=/hakoniwa title=home><img src=/hakoniwa/img/hakoniwa/icon-70x70.png></a></div><nav id=top-nav-main><ul><li><a href=/hakoniwa/docs/>箱庭とは</a></li><li><a href=/hakoniwa/prototypes/>プロトタイプモデル</a></li><li><a href=/hakoniwa/technical-links/>技術情報</a></li><li><a href=/hakoniwa/showcase/>ショーケース</a></li><li><a href=/hakoniwa/tutorial/>チュートリアル</a></li><li><a href=/hakoniwa/repositories/>リポジトリ</a></li><li><a href=/hakoniwa/contact/>SNS・問合せ先</a></li></ul></nav><nav id=top-nav-extra><ul><li><a href=# class="active language">JP</a></li></ul></nav></div></header><main><div id=main><div id=hero><h1>単体ロボット向けシミュレータ使用手順(ARM版)</h1><p class=hero-lead>.</p></div><div id=kube-component class=content><h1 id=単体ロボット向けシミュレータ使用手順arm版>単体ロボット向けシミュレータ使用手順(ARM版)</h1><h2 id=使用手順>使用手順</h2><ol><li>環境変数の設定(Mac版のみ)</li><li>cfgフォルダの配置(初回起動時のみ)</li><li>EV3ロボット制御プログラムのビルド</li><li>Unityのシミュレータの起動</li><li>athrillの起動</li></ol><h2 id=環境変数の設定mac版のみ>環境変数の設定(Mac版のみ)</h2><hr><p>Mac版の場合，gccインストールフォルダの環境変数の設定が必要になります．</p><pre tabindex=0><code>export GCC_PATH=&lt;gccインストールフォルダ&gt;/gcc-arm-none-eabi-9-2019-q4-major
</code></pre><h2 id=cfgフォルダの配置初回起動時のみ>cfgフォルダの配置(初回起動時のみ)</h2><hr><p>cfg ファイルの配置(Mac版の場合)</p><pre tabindex=0><code>$ pwd 
&lt;インストールフォルダ&gt;/ev3rt-athrill-ARMv7-A
$ mkdir cfg/cfg
$ cp cfg/cfg-mac cfg/cfg/cfg
$ chmod +x cfg/cfg/cfg
</code></pre><p>cfg ファイルの配置(Windows\Linux版の場合)</p><pre tabindex=0><code>$ pwd 
&lt;インストールフォルダ&gt;/ev3rt-athrill-ARMv7-A
$ mkdir cfg/cfg
$ cp cfg/cfg-linux-64 cfg/cfg/cfg
$ chmod +x cfg/cfg/cfg
</code></pre><h2 id=ev3ロボット制御プログラムのビルド>EV3ロボット制御プログラムのビルド</h2><hr><p>ターミナル上で，<code>ev3rt-athrill-ARMv7-A/sdk/OBJ1.1</code>に移動して，<br>EV3ロボット制御プログラムをビルドしましょう．</p><p>ビルドするには，以下のコマンドを実行してください．</p><pre tabindex=0><code>make clean;make
</code></pre><p>ビルド成功すると，asp というバイナリができます．</p><pre tabindex=0><code>$ ls asp
asp
</code></pre><h2 id=unityのシミュレータの起動>Unityのシミュレータの起動</h2><hr><p><strong>※必ず，athrillの起動より先にUnityのシミュレータの起動を行ってください</strong></p><p>次に，Unityをシミュレーションモードにします．
Unityの画面上で<a href="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F1365fe63-28e1-0b02-e615-91b1f23724b9.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d95a1ef03fd2f1640baf832491fcc986"><img src="https://qiita-user-contents.imgix.net/https%3A%2F%2Fqiita-image-store.s3.ap-northeast-1.amazonaws.com%2F0%2F244147%2F1365fe63-28e1-0b02-e615-91b1f23724b9.png?ixlib=rb-1.2.2&amp;auto=format&amp;gif-q=60&amp;q=75&amp;s=d95a1ef03fd2f1640baf832491fcc986" alt=image.png></a>　ボタンを押下してください．</p><p>成功すると，下図のような画面に切り替わります．(画像は single-robot-HackEV.unitypackage の場合)</p><figure><img src=/hakoniwa/img/single-robot/unity_run.png border width=900></figure><h2 id=athrillの起動>athrillの起動</h2><hr><p>最後に，athrillを起動しましょう．</p><p><code>ev3rt-athrill-ARMv7-A/sdk/OBJ1.1</code>に移動して，以下のコマンドを実行してください．</p><ul><li>unityとの通信が UDP の場合</li></ul><p>UDP版の場合</p><pre tabindex=0><code>$ athrill2 -c1 -t -1 -m memory.txt -d device_config.txt ../asp
</code></pre><p>MMAP版の場合</p><pre tabindex=0><code>$ athrill2 -c1 -t -1 -m memory_mmap.txt -d device_config_mmap.txt ../asp
</code></pre><p>成功すると，以下のログが出力され，Unity上のEV3ロボットが動き始めます．</p><pre tabindex=0><code>core id num=1
ROM : START=0x0 SIZE=512
RAM : START=0x5ff7000 SIZE=10240
Elf loading was succeeded:0x0 - 0xfd68 : 63.360 KB
ELF SYMBOL SECTION LOADED:index=22
ELF SYMBOL SECTION LOADED:sym_num=964
ELF STRING TABLE SECTION LOADED:index=23
athrill_device_func_call=0x60f7444

TOPPERS/ASP3 Kernel Release 3.2.0 for V850-ESFK3 (Nov  6 2019, 10:56:14)
Copyright (C) 2000-2003 by Embedded and Real-Time Systems Laboratory
                            Toyohashi Univ. of Technology, JAPAN
Copyright (C) 2004-2017 by Embedded and Real-Time Systems Laboratory
            Graduate School of Information Science, Nagoya Univ., JAPAN

brick_dri initialized.
   _____   ______ ___  ______
  / __/ | / /_  // _ \/_  __/
 / _/ | |/ //_ &lt;/ , _/ / /
/___/ |___/____/_/|_| /_/



Powered by TOPPERS/HRP2 RTOS
Initialization is completed..
System logging task is started.
</code></pre><h2 id=シミュレータのデバッグ>シミュレータのデバッグ</h2><hr><p>下記のコマンドでathrillを実行すると，デバッグモードで実行することができます</p><p>UDP版の場合</p><pre tabindex=0><code>$ athrill2 -c1 -i -t -1 -m memory.txt -d device_config.txt ../asp
</code></pre><p>MMAP版の場合</p><pre tabindex=0><code>$ athrill2 -c1 -i -t -1 -m memory_mmap.txt -d device_config_mmap.txt ../asp
</code></pre><p>デバックモードの場合，athrillを実行しているコンソールにて<code>q</code>コマンドを入力し，Enterを押下することで，<br>処理が停止します．<br>処理が停止している間は，Unity側のシミュレータも動作を停止します．<br>処理が停止している状態で，athrillを実行しているコンソールにて<code>c</code>コマンドを入力し，Enterを押下することで処理が再開します．</p><p>athrill実行時のデバッグコマンドの詳細についてはこちらをご確認ください．</p><ul><li><a href=https://qiita.com/kanetugu2018/items/cf3dea16710a3f0737e8#%E3%83%9E%E3%83%8B%E3%83%A5%E3%82%A2%E3%83%AB>athrill(アスリル)機能マニュアル(Qiita記事へのリンクです)</a></li></ul></div></div></main><footer><footer id=footer><nav><ul><li><span>HAKONIWA-WG</span></li></ul></nav><p>&copy; 2019- by Hakoniwa Working-Group, TOPPERS Project</p></footer></footer><script src=/hakoniwa/js/kube.js type=text/javascript></script><script src=/hakoniwa/js/kube.legenda.js type=text/javascript></script><script src=/hakoniwa/js/main.js type=text/javascript></script></body></html>